!function(){"use strict";function w(){}function p(t){t.preventDefault()}var t,n,u=(t={set:function(t,n,i){return t[0]=n,t[1]=i,t},create:function(t,n){return Float32Array.of(t,n,i++)}},Object.assign(Object.create(null),t)),i=0,o=Object.create(null);o[o[n=0]="IN"]=n++,o[o[n]="OUT"]=n++,o.inverse=function(t){return(t+1)%2};var r,j=Object.create(null);j[j[r=0]="START"]=r++,j[j[r]="MOVE"]=r++,j[j[r]="END"]=r++;var s=SVG();function c(){s.size(window.innerWidth,window.innerHeight)}function e(t,n){return u.set(t,n.cx(),n.cy())}c(),document.body.appendChild(s.node),window.addEventListener("resize",c);var h,f=200,a=100,l=10,v=a+10,d=f+20+2*l,b=u.create(10+l,5),g=[u.create(5,5+a/2-5),u.create(f+l+15,5+a/2-5)],m=s.group().addClass("connections"),O=s.group().addClass("thumbnails");function S(t,n,i){var r=n[0],s=n[1],u=i[0],o=i[1],c=Math.max((u-r)/2,50);t.plot("M "+r+" "+s+" L "+(r+c)+" "+s+" L "+(u-c)+" "+o+" L "+u+" "+o)}function k(t,n,i,r){var s=O.group().addClass("thumbnail").remember("editor",t.t);s.background=s.rect(d,v).addClass("background").move(i,r),s.placeholder=s.rect(f,a).addClass("placeholder").move(b[0]+i,b[1]+r),s.i=s.image().load(n,T).move(b[0]+i,b[1]+r);for(var u=s.s=[],o=0;o<2;o++){var c=g[o];u.push(s.circle(l).addClass("socket").move(c[0]+i,c[1]+r))}return function(r,s,u,o){void 0===o&&(o=w);var c=0,e=0,h=0,f=!1,a=!1,l=null;function v(t){if(f){var n=t.pageX-c,i=t.pageY-e;u(r,t.target,n,i,h)}}function d(t){if(f){var n=t.pageX-c,i=t.pageY-e;o(r,t.target,n,i,h)}}r.on("pointerdown",function(t){var n=t.target;if(h=j.START,a=s(n)){var i=r.rbox();c=t.pageX-i.x,e=t.pageY-i.y}else e=c=0;n.setPointerCapture(t.pointerId),f=!0,l=n,function(t,n){document.addEventListener("pointermove",t),t(n)}(a?v:d,t),h=j.MOVE}),r.on("pointerup",function(t){f&&(h=j.END,function(t,n){document.removeEventListener("pointermove",t),t(n)}(a?v:d,t),l.releasePointerCapture(t.pointerId),a=f=!1,l=null)}),r.on("dragstart",p)}(s,M,E,A),s}function L(t){return"socket"===t.getAttribute("class")}function M(t){return!L(t)}function T(){this.size(f,a)}function A(t,n,i,r,s){var u=n.instance.remember("controller");u.connection&&u.disconnect(),j.START!==s?j.END===s?(h.stop(i,r),h=null):h.update(i,r):h=t.remember("editor").u(u,i,r)}function E(t,n,i,r,s){if(s===j.START&&O.add(t),s===j.MOVE){t.background.move(i,r);var u=b[0]+i,o=b[1]+r;t.placeholder.move(u,o),t.i.move(u,o);for(var c=t.s,e=0;e<2;e++){var h=g[e],f=c[e];f.move(h[0]+i,h[1]+r),f.remember("controller").update()}}}var N=u.create(0,0),V=u.create(0,0),y=(z.prototype.update=function(t,n){u.set(V,t,n),this.o()},z.prototype.o=function(){S(this.view,this.input,this.h)},z.prototype.l=function(t){var n=this.origin;return t&&t!==n&&t!==n.v&&t.type!==n.type&&null===t.connection},z.prototype.stop=function(t,n){var i=function(t,n){var i=document.elementFromPoint(t,n);return L(i)?i.instance.remember("controller"):null}(t,n);if(this.l(i)){e(V,i.view),this.o();var r=this.origin,s=r.type===o.OUT;this.t.connect(s?r:i,s?i:r,this.view)}else this.p()},z.prototype.p=function(){this.view.remove(),this.view=null},z);function z(t,n,i,r){this.t=t,this.origin=n,u.set(V,i,r),e(N,n.view);var s=n.type===o.OUT;this.input=s?N:V,this.h=s?V:N,this.view=function(t){var n=m.path();return S(n,t.input,t.h),n}(this)}var D=(F.prototype.update=function(){var t=this.connection;t&&t.update()},F.prototype.disconnect=function(){var t=this.connection;t&&t.p()},F);function F(t,n,i){this.type=i,this.view=n.remember("controller",this),this.v=null,this.i=t,this.connection=null}var G=function(t,n,i,r){var s=this;this.t=t,this.view=k(this,n,i,r),this.s=this.view.s.map(function(t,n){return new D(s,t,n)}).map(function(t,n,i){return t.v=i[o.inverse(n)],t})},I=(R.prototype.update=function(){e(U,this.source.view),e(q,this.destination.view),S(this.view,U,q)},R.prototype.p=function(){this.source.connection=null,this.destination.connection=null,this.view.remove()},R);function R(t,n,i){this.source=t,this.destination=n,e(U,t.view),e(q,n.view),this.view=i||function(t,n){var i=m.path();return S(i,t,n),i}(U,q),t.connection=this,n.connection=this}var U=u.create(0,0),q=u.create(0,0);function x(){this.j=new Set,this.g=new Set}var B=new(x.prototype.add=function(t,n,i){var r=new G(this,t,n,i);return this.j.add(r),r},x.prototype.u=function(t,n,i){return new y(this,t,n,i)},x.prototype.connect=function(t,n,i){this.g.add(new I(t,n,i))},x);B.add("assets/a.jpg",350,100),B.add("assets/b.jpg",50,50),B.add("assets/c.jpg",350,250),B.add("assets/d.jpg",50,200),B.add("assets/e.jpg",350,400),B.add("assets/f.jpg",50,350)}();//# sourceMappingURL=demo.min.js.map
